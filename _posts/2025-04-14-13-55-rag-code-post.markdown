---
layout: post
title:  "Personal-Prompts"
date:   2025-04-14 13:55:00 +0900
categories: [konkuk, rag-code]
--- 

# LangChainμΌλ΅ λ§λ“λ” κ°μΈν™”λ ν”„λ΅¬ν”„νΈ

μ΄ λ¬Έμ„λ” `04-Personal-Prompts.ipynb`μ λ‚΄μ©μ„ λ°”νƒ•μΌλ΅, **LangChainμ„ ν™μ©ν•΄ κ°μΈν™”λ ν”„λ΅¬ν”„νΈλ¥Ό μ„¤κ³„ν•λ” λ°©λ²•**μ„ μ΄λ³΄μλ„ μ‰½κ² μ΄ν•΄ν•  μ μλ„λ΅ μ •λ¦¬ν• μ‹¤μµν• κ°€μ΄λ“μ…λ‹λ‹¤.

> π“ μ‚¬μ©μμ μ„±ν–¥μ΄λ‚ λ°μ΄ν„°λ¥Ό λ°”νƒ•μΌλ΅ κ°μΈ λ§μ¶¤ν• AI μ‘λ‹µμ„ μƒμ„±ν•λ” ν”„λ΅¬ν”„νΈ μ„¤κ³„ λ°©μ‹μ…λ‹λ‹¤.

---

## λ©μ°¨
{:toc}

---

## μ„Ήμ… 1

> π“ **μ„¤λ…**

LangChain μ•„μ΄λ””λ¥Ό μ…λ ¥ν•©λ‹λ‹¤.

```python
from dotenv import load_dotenv

load_dotenv()
```

---

## μ„Ήμ… 2

> π“ **μ„¤λ…**

## μ”μ•½: Stuff Documents

```python
# Owner μ§€μ •
PROMPT_OWNER = "teddynote"
```

---

## μ„Ήμ… 3

> π“ **μ„¤λ…**

## Map Prompt

```python
from langchain import hub
from langchain.prompts import PromptTemplate

prompt_title = "summary-stuff-documents"

# μ”μ•½λ¬Έμ„ μ‘μ„±ν•κΈ° μ„ν• ν”„λ΅¬ν”„νΈ μ •μ (μ§μ ‘ ν”„λ΅¬ν”„νΈλ¥Ό μ‘μ„±ν•λ” κ²½μ°)
prompt_template = """Please summarize the sentence according to the following REQUEST.
REQUEST:
1. Summarize the main points in bullet points.
2. Each summarized sentence must start with an emoji that fits the meaning of the each sentence.
3. Use various emojis to make the summary more interesting.
4. DO NOT include any unnecessary information.

CONTEXT:
{context}

SUMMARY:"
"""
prompt = PromptTemplate.from_template(prompt_template)
prompt
```

---

## μ„Ήμ… 4

> π“ **μ„¤λ…**

## Reduce Prompt

```python
hub.push(f"{PROMPT_OWNER}/{prompt_title}", prompt)
```

---

## μ„Ήμ… 5

> π“ **μ„¤λ…**

## Metadata Tagger

```python
from langchain import hub
from langchain.prompts import PromptTemplate

prompt_title = "map-prompt"

# μ”μ•½λ¬Έμ„ μ‘μ„±ν•κΈ° μ„ν• ν”„λ΅¬ν”„νΈ μ •μ (μ§μ ‘ ν”„λ΅¬ν”„νΈλ¥Ό μ‘μ„±ν•λ” κ²½μ°)
prompt_template = """You are a helpful expert journalist in extracting the main themes from a GIVEN DOCUMENTS below.
Please provide a comprehensive summary of the GIVEN DOCUMENTS in numbered list format. 
The summary should cover all the key points and main ideas presented in the original text, while also condensing the information into a concise and easy-to-understand format. 
Please ensure that the summary includes relevant details and examples that support the main ideas, while avoiding any unnecessary information or repetition. 
The length of the summary should be appropriate for the length and complexity of the original text, providing a clear and accurate overview without omitting any important information.

GIVEN DOCUMENTS:
{docs}

FORMAT:
1. main theme 1
2. main theme 2
3. main theme 3
...

CAUTION:
- DO NOT list more than 5 main themes.

Helpful Answer:
"""
prompt = PromptTemplate.from_template(prompt_template)
prompt
```

---

## μ„Ήμ… 6

> π“ **μ„¤λ…**

## Chain of Density μ”μ•½

```python
hub.push(f"{PROMPT_OWNER}/{prompt_title}", prompt)
```

---

## μ„Ήμ… 7

> π“ **μ„¤λ…**

## Chain of Density (Korean) - 2

```python
from langchain import hub
from langchain.prompts import PromptTemplate

prompt_title = "reduce-prompt"

# μ”μ•½λ¬Έμ„ μ‘μ„±ν•κΈ° μ„ν• ν”„λ΅¬ν”„νΈ μ •μ (μ§μ ‘ ν”„λ΅¬ν”„νΈλ¥Ό μ‘μ„±ν•λ” κ²½μ°)
prompt_template = """You are a helpful expert in summary writing.
You are given numbered lists of summaries.
Extract top 10 most important insights from the summaries.
Then, write a summary of the insights in KOREAN.

LIST OF SUMMARIES:
{doc_summaries}

Helpful Answer:
"""
prompt = PromptTemplate.from_template(prompt_template)
prompt
```

---

## μ„Ήμ… 8

> π“ **μ„¤λ…**

## RAG λ¬Έμ„ ν”„λ΅¬ν”„νΈ

```python
hub.push(f"{PROMPT_OWNER}/{prompt_title}", prompt)
```

---

## μ„Ήμ… 9

> π“ **μ„¤λ…**

## RAG + μ¶μ²

```python
from langchain import hub
from langchain.prompts import PromptTemplate

prompt_title = "chain-of-density-reduce-korean"

# μ”μ•½λ¬Έμ„ μ‘μ„±ν•κΈ° μ„ν• ν”„λ΅¬ν”„νΈ μ •μ (μ§μ ‘ ν”„λ΅¬ν”„νΈλ¥Ό μ‘μ„±ν•λ” κ²½μ°)
prompt_template = """You are a helpful expert in summary writing. You are given lists of summaries.
Please sum up previously summarized sentences according to the following REQUEST.
REQUEST:
1. Summarize the main points in bullet points in KOREAN.
2. Each summarized sentence must start with an emoji that fits the meaning of the each sentence.
3. Use various emojis to make the summary more interesting.
4. MOST IMPORTANT points should be organized at the top of the list.
5. DO NOT include any unnecessary information.

LIST OF SUMMARIES:
{doc_summaries}

Helpful Answer: """
prompt = PromptTemplate.from_template(prompt_template)
prompt
```

---

## μ„Ήμ… 10

> π“ **μ„¤λ…**

## LLM Evaluation

```python
hub.push(f"{PROMPT_OWNER}/{prompt_title}", prompt)
```

---

## ν•µμ‹¬ μ”μ•½: κ°μΈν™”λ ν”„λ΅¬ν”„νΈ μ„¤κ³„λ€?

> π’΅ μ‚¬μ©μ μ •λ³΄λ‚ λ§¥λ½μ„ ν™μ©ν•΄ λ§μ¶¤ν• μ‘λ‹µμ„ μƒμ„±ν•λ” ν”„λ΅¬ν”„νΈ λ°©μ‹μ…λ‹λ‹¤.

- **μ‚¬μ©μ μ •μ λ³€μ**λ¥Ό ν…ν”λ¦Ώμ— ν¬ν•¨μ‹μΌ, μ…λ ¥λ§λ‹¤ λ‹¤λ¥Έ κ²°κ³Όλ¥Ό μ λ„ν•  μ μμµλ‹λ‹¤.
- `PromptTemplate`κ³Ό μ‚¬μ©μ μ •λ³΄(JSON, dict λ“±)λ¥Ό κ²°ν•©ν•μ—¬ ν”„λ΅¬ν”„νΈλ¥Ό κµ¬μ„±ν•©λ‹λ‹¤.
- `ChatPromptTemplate`κ³Ό ν•¨κ» μ‚¬μ©ν•λ©΄ λ©€ν‹° ν„΄ λ€ν™”μ—λ„ λ€μ‘ν•  μ μμµλ‹λ‹¤.

### μμ‹ μ½”λ“
```python
from langchain.prompts import ChatPromptTemplate

template = ChatPromptTemplate.from_messages([
    ("system", "λ‹Ήμ‹ μ€ λ§μ¶¤ν• μ΅°μ–Έμ„ ν•΄μ£Όλ” μ „λ¬Έκ°€μ…λ‹λ‹¤."),
    ("human", "{user_name}λ‹μ€ μ–΄λ–¤ κ³ λ―Όμ΄ μμΌμ‹ κ°€μ”?")
])

template.format(user_name="κ΄‘μΌ")
```

> β… κ°μΈν™”λ ν”„λ΅¬ν”„νΈλ” μ±—λ΄‡, μ¶”μ² μ‹μ¤ν…, λ§μ¶¤ν• μƒλ‹΄ λ“±μ— μ μ©ν•κ² μ μ©λ©λ‹λ‹¤.