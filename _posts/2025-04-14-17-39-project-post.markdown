---
layout: post
title:  "MCP 기반 금융 확률 분석 시스템 개발기 1"
date:   2025-04-14 17:39:00 +0900
categories: [konkuk, project]
--- 
# 📊 MCP 기반 금융 확률 분석 시스템 개발기 1

이 프로젝트는 **생성형 AI를 기반으로 금융시장 조건부 확률을 해석 및 계산**하는 시스템의 정확도와 응답 성능을 테스트하기 위한 것입니다.

## ✅ 프로젝트 개요

- **목표**: 사용자가 자연어로 입력한 조건 (예: "유로 FX 선물 가격이 상승하면 엔화는 하락하는가?")에 대해 **AI가 명확한 수치 기반 확률을 응답**하는 솔루션 구축
- **기술 환경**:
  - Claude Pro 요금제 사용
  - Yahoo-Finance MCP 서버 연동
- **이슈**:
  - Claude 무료 요금제는 컨텍스트 길이 제한으로 인해 정확한 응답 불가
  - 약 **한 달 이상의 데이터**를 사용하면 Claude Pro에서도 컨텍스트 한계로 인해 분석 중단

---

## 🧪 실험 질문 리스트

총 10개의 핵심 시나리오를 기반으로 조건부 확률 응답의 **정확도·일관성·분석 신뢰성**을 평가합니다:

### 1. 유로 FX 선물과 엔화
> **"유로 FX 선물 가격이 5% 상승할 경우, 엔화 환율이 3% 하락할 확률을 산출할 수 있는가? 구체적인 수치를 계산하십시오."**

### 2. 미국 기술주와 S&P 500 선물
> **"S&P 500 선물 가격이 상승했을 때, 애플과 마이크로소프트와 같은 주요 기술주의 주가가 각각 상승할 확률의 상세한 계산 결과를 제시해 주세요."**

### 3. 원유 선물과 에너지 주식
> **"WTI 원유 선물 가격이 4% 하락할 때, 에너지 관련 주식 및 ETF들의 수익률이 2% 이상 하락할 구체적인 확률 값을 산출해 주세요."**

### 4. 금 선물과 광산주
> **"금 선물 가격이 10% 급등하면, 주요 광산주들의 주가가 상승할 확률이 얼마인가? 명시된 확률 값을 기반으로 산출 결과를 제시해 주세요."**

### 5. 국채 선물과 위험자산
> **"시장 불안 시 국채 선물 가격이 5% 상승할 경우, 동시에 위험자산인 주식시장의 주가가 4% 이상 하락할 확률을 얼마로 평가되는지 구체적인 수치로 계산해 주세요."**

### 6. 코스피 200 선물과 금융주 변동성
> **"코스피 200 선물 가격이 3% 하락할 때, 금융주들의 변동성이 20% 이상 증가할 확률을 산출하여 구체적인 확률 계산 결과를 제시해 주세요."**

### 7. 암호화폐 선물과 전통주
> **"암호화폐 선물 가격의 변동성이 15% 확대될 때, 대형 기술주나 금융주의 주가가 5% 이상 변동할 구체적인 확률 수치를 산출해 주세요."**

### 8. 달러 인덱스와 수출주
> **"달러 인덱스가 5% 강세를 보일 경우, 주요 수출 중심 기업들의 주가가 3% 이상 하락할 확률을 명확한 수치로 계산해 주세요."**

### 9. 유럽 증시 선물과 주요 산업 주식
> **"브렉시트 관련 불확실성 이후 FTSE 100 선물 가격이 4% 하락하면, 유럽의 주요 산업(예: 금융, 자동차) 주식이 3% 이상 하락할 확률을 구체적으로 계산할 수 있는가?"**

### 10. 중국 경제지표와 ETF
> **"중국 제조업 PMI 개선과 함께 중국 관련 ETF 선물 가격이 6% 상승할 경우, 글로벌 원자재 가격이 4% 이상 상승할 확률에 대해 구체적인 수치 결과를 제시해 주세요."**

---

## 💡 실험 결과 및 분석

### Q0: 마이크로소프트-애플 상관관계 분석

**질문:**
> "최근 한 달간 Microsoft 주식이 상승하여 양봉 마감할 때, Apple 주식이 음봉 마감한 확률과 상관계수를 계산해봐"

**응답 요약:**
- Microsoft가 상승한 날: 총 12일
- Microsoft가 상승이고 Apple이 음봉인 날: 총 1일 (2025-03-28)
- Microsoft 상승일 때 Apple 음봉 확률: **8.33%**
- 두 주식의 가격 변동의 상관계수: **0.9407**

**분석:**
1. **데이터 수집 과정**: MCP 도구를 통해 Yahoo Finance에서 주식 데이터를 효과적으로 수집함
2. **결과 정확성**: 확률 계산과 상관계수 계산이 모두 올바른 방법으로 진행됨
3. **결론의 타당성**: 두 주식 간 강한 양의 상관관계(0.9407)가 있으며, 이는 금융 시장 상식과도 일치함

**평가 점수: 95/100**
- MCP 도구 활용: 우수
- 계산 정확도: 우수
- 통계 적용: 우수
- 해석 품질: 양호

### Q1: 유로-엔화 조건부 확률 계산

**질문:**
> "야후 파이낸스 데이터를 활용하여 최근 한 달간 유로 FX 선물 가격이 5% 상승할 경우, 엔화 환율이 3% 하락할 확률을 산출할 수 있는가? 구체적인 수치 계산을 부탁드립니다."

**응답 요약:**
- 상관관계: 유로 FX 선물과 엔화 환율 사이에는 약 **-0.60**의 상관관계가 존재함 (음의 상관관계)
- 조건부 확률 모델: 이변량 정규분포 모델을 사용하여 유로 FX 선물이 5% 상승한다는 조건 하에 엔화 환율이 3% 하락할 확률을 계산
- 계산 결과: 유로 FX 선물 가격이 5% 상승할 경우, 엔화 환율이 3% 하락할 확률은 약 **90.78%**

**분석:**
1. **방법론**: 이변량 정규분포와 조건부 확률 계산법을 올바르게 적용함
2. **신뢰도**: Z-검정 결과 약 1.33으로, 약 90.78%의 확률로 이 조건이 성립함을 확인
3. **데이터 해석**: 두 통화 사이의 강한 음의 상관관계(-0.60)를 정확히 포착하여 분석함

**평가 점수: 92/100**
- MCP 도구 활용: 우수
- 통계 모델 선택: 우수
- 조건부 확률 계산: 우수
- 해석의 명확성: 양호
- 실제 금융 시장 이해: 양호

### Q2: S&P 500-기술주 상승 확률 분석

**질문:**
> "S&P 500 선물 가격이 상승했을 때, 애플과 마이크로소프트와 같은 주요 기술주의 주가가 각각 상승할 확률의 상세한 계산 결과를 제시해 주세요."

**응답 요약:**
1. **기본 확률 분석**:
   - S&P 500 선물 상승 시 애플 주가 상승 확률: **100.00%** (10일 중 10일)
   - S&P 500 선물 상승 시 마이크로소프트 주가 상승 확률: **80.00%** (10일 중 8일)
   - S&P 500 선물 상승 시 두 기술주 모두 상승 확률: **80.00%** (10일 중 8일)

2. **상관관계 및 베타 분석**:
   - 애플의 베타: **1.4615** (S&P 500 선물보다 약 1.46배 큰 변동성)
   - 마이크로소프트의 베타: **0.8097** (S&P 500 선물보다 약 0.81배 작은 변동성)
   - 애플-S&P 500 상관계수: **0.9268** (매우 강한 양의 상관관계)
   - 마이크로소프트-S&P 500 상관계수: **0.9042** (매우 강한 양의 상관관계)

3. **S&P 500 선물 상승 폭에 따른 확률 분석**:
   - 0-1% 상승 시: 애플 100%, 마이크로소프트 60% 상승 확률
   - 1-2% 상승 시: 애플 100%, 마이크로소프트 100% 상승 확률
   - 3%+ 상승 시: 애플 100%, 마이크로소프트 100% 상승 확률

**분석:**
1. **종합적 접근**: 단순 확률 계산뿐만 아니라 베타와 상관계수를 통한 심층 분석을 제공함
2. **세부적 분석**: S&P 500의 상승 폭에 따른 조건부 확률의 변화를 세분화하여 분석함
3. **통계적 견고성**: 충분한 데이터 포인트를 통해 확률 계산의 신뢰성을 확보함

**평가 점수: 98/100**
- MCP 도구 활용: 탁월
- 다각적 분석: 탁월
- 해석의 깊이: 우수
- 시각화 및 정리: 우수
- 금융 시장 이해: 탁월

---

## 📝 향후 작업

- 각 질문에 대해 Claude Pro + MCP 기반 실험 진행
- 조건부 확률 수치 + 상관계수 + 통계적 신뢰도 기록
- 컨텍스트 길이 초과 이슈 정량 측정 (token 수 기준)
- Q3~Q10 질문에 대한 분석 및 결과 정리

## 🔍 초기 결론

첫 세 가지 실험(Q0-Q2)을 통해 다음과 같은 사항을 확인했습니다:

1. **MCP 도구의 효용성**: Yahoo Finance API를 통해 실제 금융 데이터를 효과적으로 수집하여 정확한 분석 기반을 마련
2. **통계적 방법론의 적합성**: 조건부 확률, 상관계수, 베타 계수 등 다양한 통계 도구를 성공적으로 적용
3. **응답 품질**: 단순 확률 계산을 넘어 금융 시장 맥락에서의 해석까지 제공하는 높은 수준의 응답
4. **한계점**: 데이터 양이 많아질수록 컨텍스트 제한으로 인한 분석 제약 발생

향후 실험에서는 더 복잡한 금융 관계와 다양한 자산 클래스에 대한 조건부 확률을 테스트하며, 이러한 분석의 실제 투자 의사결정 적용 가능성을 탐색할 예정입니다.